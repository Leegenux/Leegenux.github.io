<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://leegenux.xyz/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Evan Lee">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://leegenux.xyz"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-code-your-own-server-client-with-C" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/15/code-your-own-server-client-with-C/" class="article-date">
  <time class="dt-published" datetime="2019-02-15T15:39:07.000Z" itemprop="datePublished">2019-02-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/15/code-your-own-server-client-with-C/">Code Your Own Server/Client Software With C socket APIs</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>In this article I’m gonna show you how to code a simple echo server and corresponding client from scratch. </p>
<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><p>To achieve the goal, we should first learn about some basic C APIs.</p>
<h3 id="Commonly-Seen-Structures"><a href="#Commonly-Seen-Structures" class="headerlink" title="Commonly Seen Structures"></a>Commonly Seen Structures</h3><h4 id="1-struct-hostent"><a href="#1-struct-hostent" class="headerlink" title="1. struct hostent"></a>1. <code>struct hostent</code></h4><p><code>hostent</code> is abbreviation of <code>host entry</code>. Its instance is usally used to store the return value of <code>gethostbyname()</code> function. It’s imported by including <code>&lt;netdb.h&gt;</code></p>
<p>This is its definition:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostent</span>&#123;</span></span><br><span class="line">    <span class="type">char</span> * h_name;</span><br><span class="line">    <span class="type">char</span> ** h_aliases;</span><br><span class="line">    <span class="type">short</span> h_addrtype;</span><br><span class="line">    <span class="type">short</span> h_length;</span><br><span class="line">    <span class="type">char</span> ** h_addr_list;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> h_addr h_addr_list[0];</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-struct-in-addr"><a href="#2-struct-in-addr" class="headerlink" title="2. struct in_addr"></a>2. <code>struct in_addr</code></h4><p>This data structure contains just one member <code>in_addr_t s_addr;</code>. Its header file is <code>&lt;arpa/inet.h&gt;</code></p>
<p>Its declaration is as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> &#123;</span></span><br><span class="line">    <span class="type">in_addr_t</span> s_addr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The type <code>in_addr_t</code> is in most cases alias of 32 bits <code>unsigned int</code>.</p>
<h4 id="3-struct-sockaddr-in"><a href="#3-struct-sockaddr-in" class="headerlink" title="3. struct sockaddr_in"></a>3. <code>struct sockaddr_in</code></h4><p>Before introducing this structure, you should scan through definition below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span>  <span class="type">short</span>  sa_family;     <span class="comment">/* address family, AF_xxx */</span></span><br><span class="line">    <span class="type">char</span>  sa_data[<span class="number">14</span>];                 <span class="comment">/* 14 bytes of protocol address */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Structure above usually serves as parameter of functions <code>bind</code>, <code>connect</code>, <code>recvfrom</code> and <code>sendto</code>, etc. Its second member is not much readable for human, so developers introduced its equivalent structure. Cast between their pointers is secure.</p>
<p>Let’s look at the equivalent structure’s definition:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> &#123;</span></span><br><span class="line">    <span class="type">short</span> <span class="type">int</span> sin_family; <span class="comment">/* Address family */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> sin_port; <span class="comment">/* Port number */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">sin_addr</span>;</span> <span class="comment">/* Internet address */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> sin_zero[<span class="number">8</span>]; <span class="comment">/* Same size as struct sockaddr */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Code above suggests that <code>struct sockaddr</code> in fact contains information about address-family, port and address. </p>
<p>The header for <code>sockaddr</code> is <code>&lt;sys/socket.h&gt;</code>, and <code>&lt;netinet/in.h&gt;</code> for structure <code>sockaddr_in</code>.</p>
<h3 id="Commonly-Seen-Functions"><a href="#Commonly-Seen-Functions" class="headerlink" title="Commonly Seen Functions"></a>Commonly Seen Functions</h3><h4 id="One-Parameter-Functions"><a href="#One-Parameter-Functions" class="headerlink" title="One Parameter Functions"></a>One Parameter Functions</h4><ul>
<li><code>gethostbyname</code> : Literally understood.</li>
<li><code>inet_ntoa</code>: Transfer <code>in_addr</code> into human-readable format.</li>
<li><code>inet_addr</code>: Do reverse transformation of <code>inet_ntoa</code>.</li>
<li><code>htonl</code>: Host-to-Net Long conversion.</li>
<li><code>htons</code>: Host-to-Net Short conversion.</li>
<li><code>close</code>: Close the socket handle.</li>
</ul>
<p><code>gethostbyname</code>, <code>inet_ntoa</code>, <code>inet_addr</code>, <code>htonl</code> and <code>htons</code> all take just one parameter. </p>
<p>Here <code>htox</code> functions mainly focus on adapting endianness, while <code>inet_xxxx</code> functions on transformation between machine presentation and human-readable format.</p>
<h4 id="Multi-parameter-Functions"><a href="#Multi-parameter-Functions" class="headerlink" title="Multi-parameter Functions"></a>Multi-parameter Functions</h4><ul>
<li><code>socket</code>: Create socket instance.</li>
<li><code>connect</code></li>
<li><code>send</code></li>
<li><code>recv</code></li>
<li><code>listen</code></li>
<li><code>accept</code></li>
</ul>
<p>These functions take multiple parameters. If you compare each one with another, you can reveal a pattern of parameters for them all. Here I won’t talk too much about this.</p>
<p>If you are struggling figuring out the meanings of terms like “send”, “listen” and so on, I recommend you to first learn some basics about <a target="_blank" rel="noopener" href="https://searchnetworking.techtarget.com/definition/TCP-IP">TCP&#x2F;IP</a> and socket.</p>
<h2 id="Hands-on-Coding"><a href="#Hands-on-Coding" class="headerlink" title="Hands-on Coding"></a>Hands-on Coding</h2><p><a target="_blank" rel="noopener" href="https://github.com/Leegenux/C_socket_client_server">Here</a> you can preview the result we are going to produce.</p>
<h3 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h3><p>First, let’s start with retrieving basic information using system-provided APIs. Say getting IP of a given URL. </p>
<p>In Unix-like systems, there is tool named <code>nslookup</code> which does the job mentioned above. Here is an example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ nslookup google.com</span><br><span class="line">Server:         127.0.0.53</span><br><span class="line">Address:        127.0.0.53#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:   google.com</span><br><span class="line">Address: 172.217.160.110</span><br><span class="line">Name:   google.com</span><br><span class="line">Address: 2404:6800:4008:802::200e</span><br></pre></td></tr></table></figure>

<p>We can code our own simpler version using APIs provided by operating system.</p>
<p>According to the prerequisite section, we can use the <code>gethostbyname</code> to finish the code.</p>
<p>First part. The includes :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>          <span class="comment">/* stderr, stdout */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netdb.h&gt;</span>          <span class="comment">/* hostent struct, gethostbyname() */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span>      <span class="comment">/* inet_ntoa() to format IP address */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span>     <span class="comment">/* in_addr structure *</span></span></span><br></pre></td></tr></table></figure>

<p>Then here comes the main body :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">hostent</span> *<span class="title">host</span>;</span>     <span class="comment">/* host information */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">h_addr</span>;</span>    <span class="comment">/* Internet address */</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;USAGE: nslookup &lt;inet_address&gt;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((host = gethostbyname(argv[<span class="number">1</span>])) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;(mini) nslookup failed on &#x27;%s&#x27;\n&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    h_addr.s_addr = *((<span class="type">unsigned</span> <span class="type">long</span> *) host-&gt;h_addr_list[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;%s\n&quot;</span>, inet_ntoa(h_addr));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>gethostbyname</code> takes a C-string parameter, and returns the information in the format of <code>struct hostent</code>. The member <code>h_addr_list</code> stores all results we want. To make things simpler, we just fetch and print the first IP we get. If no result is available, <code>gethostbyname</code> returns <code>NULL</code>.</p>
<h3 id="tcp-client"><a href="#tcp-client" class="headerlink" title="tcp-client"></a>tcp-client</h3><p>First part is still includes:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>Then the main function:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFSIZE 32</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br></pre></td></tr></table></figure>

<p>Check the command line parameters and print the help-string if necessary: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check the command line parameters</span></span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">4</span>) &#123;</span><br><span class="line">    fprint(<span class="built_in">stderr</span>, <span class="string">&quot;Usage: tcp-client &lt;server-ip&gt; &lt;port&gt; &lt;data&gt;\n4)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Then create the socket, the first parameter of <code>socket</code> is often set to <code>PF_INET</code> or <code>AF_INET</code>. Note that in Linux implementation, <code>AF_INET</code> is totally same as <code>PF_INET</code>. The second and third parameters are type and protocol. In this condition, we set <code>type = SOCK_STREAM</code> and <code>protocol = IPPROTO_TCP</code>. With these setups, we create a tcp socket. And the function returns a socket handle for later use, which normally should be greater than 0.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the socket</span></span><br><span class="line"><span class="type">int</span> sock;</span><br><span class="line"><span class="keyword">if</span> ((sock = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to create socket\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After that, let’s construct the server address object with command line parameters. The member <code>sin_family</code> is usually either set to <code>AF_INET</code> or <code> PF_INET</code> . And the member <code>sin_addr.s_addr</code> is actually integer as inner presentation. But you can easily get the presentation using function <code>inet_addr</code>. The last member <code>sin_zero</code> is intended for main memory alignment optimization, and should be set 0 manually.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Construct server address object</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">echoServer</span>;</span></span><br><span class="line">echoServer.sin_family = AF_INET;</span><br><span class="line">echoServer.sin_addr.s_addr = inet_addr(argv[<span class="number">1</span>]);</span><br><span class="line">echoServer.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line"><span class="built_in">memset</span>(&amp;(echoServer.sin_zero), <span class="number">0</span>, <span class="keyword">sizeof</span>(echoServer.sin_zero));</span><br></pre></td></tr></table></figure>

<p>Then, we shall try to establish the connection and send the data. Look closely at the parameters of two functions <code>connect</code> and <code>send</code>, as well as how the socket is related.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Establish connection</span></span><br><span class="line"><span class="keyword">if</span> (connect(sock, </span><br><span class="line">    (<span class="keyword">struct</span> sockaddr*) &amp;echoServer,</span><br><span class="line">    <span class="keyword">sizeof</span>(echoServer)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to connect.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send the data</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> dataLen = <span class="built_in">strlen</span>(argv[<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">if</span> (send(sock, argv[<span class="number">3</span>], dataLen, <span class="number">0</span>) != dataLen) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Data check failure.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At last, if everything goes fine, we are now at the final step. The return value of the <code>recv</code> function is the number of the bytes received. It is not guaranteed that <code>recv</code> function can get the whole echo result through one time execution. What is guaranteed is that normally when there are data to receive, <code>packSize</code> will not be 0. </p>
<p>You should answer yourself why <code>BUFFSIZE - 1</code> in the third parameter position.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Receive the echo</span></span><br><span class="line"><span class="type">short</span> received = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> buffer[BUFFSIZE];</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Echo: \n&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (received &lt; dataLen) &#123;</span><br><span class="line">    <span class="type">short</span> packSize = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((packSize = recv(sock, buffer, BUFFSIZE<span class="number">-1</span>, <span class="number">0</span>)) &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to receive byte.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    received += packSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print the echo</span></span><br><span class="line">buffer[received] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, buffer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="tcp-server"><a href="#tcp-server" class="headerlink" title="tcp-server"></a>tcp-server</h3><p>Still the old rules — the includes:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>And in the <code>main</code> function, check the arguments:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFSIZE 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXPENDING 5</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="comment">// Check the arguments</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Usage: tcp-server &lt;port&gt;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Create the socket. The arguments of function <code>socket</code> and setup of <code>echoServer</code> have been explained in section <code>tcp-client</code>. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create main socket</span></span><br><span class="line"><span class="type">int</span> serverSock;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create TCP socket</span></span><br><span class="line"><span class="keyword">if</span> ((serverSock = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to create socket\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set main socket address</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">echoServer</span>;</span></span><br><span class="line">echoServer.sin_family = AF_INET;</span><br><span class="line">echoServer.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">echoServer.sin_port = htons(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"><span class="built_in">memset</span>(&amp;(echoServer.sin_zero), <span class="number">0</span>, <span class="keyword">sizeof</span>(echoServer.sin_zero));</span><br></pre></td></tr></table></figure>

<p>After the socket is created, we should bind it to some port of the machine and listen to it so as to work as server. Note that the <code>bind</code> function has same parameters as <code>connect</code> function. There is an important attribute for socket when listening. That is the number of pending requests. Here the second parameter of <code>listen</code> stands for that attribute. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bind the main socket</span></span><br><span class="line"><span class="keyword">if</span> (bind(serverSock,</span><br><span class="line">    (<span class="keyword">struct</span> sockaddr*) &amp;echoServer,</span><br><span class="line">    <span class="keyword">sizeof</span>(echoServer)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to bind.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Listen to the main socket</span></span><br><span class="line"><span class="keyword">if</span> (listen(serverSock, MAXPENDING) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to listen on server socket.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At last, after work done above, we are truly “serving” when executing code following. <code>accept</code> function fetches the connection on the top of the pending list out and starts a conversation. It returns the handle of the client socket. After that, we ought to do echo. It’s just a loop of <code>receive</code> and <code>send</code>.</p>
<p>Answer yourself why <code>BUFFSIZE</code> and not <code>BUFFSIZE - 1</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Handle the requests</span></span><br><span class="line">    <span class="type">int</span> clientSock;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">echoClient</span>;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> clientLen = <span class="keyword">sizeof</span>(echoClient);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((clientSock = accept(serverSock,</span><br><span class="line">                            (<span class="keyword">struct</span> sockaddr*) &amp;echoClient,</span><br><span class="line">                            &amp;clientLen)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to accept the connection.\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Client connected: %s\n&quot;</span>, inet_ntoa(echoClient.sin_addr));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do the echo</span></span><br><span class="line">        <span class="type">char</span> buffer[BUFFSIZE];</span><br><span class="line">        <span class="type">int</span> received = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> ((received = recv(clientSock, buffer, BUFFSIZE, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to receive data.\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (received &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (send(clientSock, buffer, received, <span class="number">0</span>) != received) &#123;</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to echo back.\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((received = recv(clientSock, buffer, BUFFSIZE, <span class="number">0</span>)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Failed to receive data.\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        close(clientSock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Never get here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>If you have finished the code above, you can build 3 executables. Given that you name them after the sources, you can test your server and client code like this:</p>
<p>open one terminal and type <code>./tcp-server 12334</code>. </p>
<p>In another terminal, type <code>./tcp-client 127.0.0.1 12334 &#39;Hello world&#39; &amp;&amp; ./tcp-client 127.0.0.1 12334 &#39;I like you&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./tcp-server 12334</span><br><span class="line">Client connected: 127.0.0.1</span><br><span class="line">Client connected: 127.0.0.1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./tcp-client 127.0.0.1 12334 &#x27;Hello world&#x27; &amp;&amp; ./tcp-client 127.0.0.1 12334 &#x27;I like you&#x27;                                 </span><br><span class="line">Echo:</span><br><span class="line">Hello world</span><br><span class="line">Echo:</span><br><span class="line">I like you</span><br></pre></td></tr></table></figure>

<p>Above shows the result of execution on my laptop, and yours should be alike.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/15/code-your-own-server-client-with-C/" data-id="cld9kj0bg000r7swk4ddlgd2d" data-title="Code Your Own Server/Client Software With C socket APIs" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/socket/" rel="tag">socket</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-usages-of-tr" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/14/usages-of-tr/" class="article-date">
  <time class="dt-published" datetime="2019-02-14T14:15:54.000Z" itemprop="datePublished">2019-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/14/usages-of-tr/">Usages of tr</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>The command <code>tr</code> is an abbreviation of “translate” or “transliterate”. </p>
<p>In general, the <code>tr</code> command is executed in the formula: <code>tr [OPTION] SET1 [SET2]</code>. It’s a character-wise command.</p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>For first impression, look at the example below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">tr</span> <span class="string">&quot;10&quot;</span> <span class="string">&quot;-_&quot;</span> &lt;&lt;&lt; <span class="string">&quot;110101EOF&quot;</span></span><br><span class="line">--_-_-EOF</span><br></pre></td></tr></table></figure>

<p>Basically, the <code>tr</code> command translates “1” into “-“ and “0” into “_”. The remain part stays the same.</p>
<h4 id="Other-Options"><a href="#Other-Options" class="headerlink" title="Other Options"></a>Other Options</h4><p>After that easy example, let’s find out what else we can do:</p>
<ul>
<li><code>-s</code> : Replace consecutive repeats of character in the <code>SET1</code> with single occurrence. It can be used like this : <code>tr -s &quot;[a-z]&quot;</code>.</li>
<li><code>-c</code> : It indicates the complement of <code>SET1</code>. </li>
<li><code>-d</code> : Delete all characters listed in <code>SET1</code>.</li>
<li><code>-t</code> : <code>SET2</code> is extended to the length of <code>SET1</code> by repeating its last character as necessary. Excess characters  of <code>SET2</code> are ignored.</li>
</ul>
<p>These options are to be filled into the general formula introduced at the beginning of this article. Straightforward though it is, It still takes practice to master.</p>
<p>For more insights, refer to GOOGLE SEARCH.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/14/usages-of-tr/" data-id="cld9kj0bz00197swk8l3i02h0" data-title="Usages of tr" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tr/" rel="tag">tr</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-usages-of-tail-and-head" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/14/usages-of-tail-and-head/" class="article-date">
  <time class="dt-published" datetime="2019-02-13T16:00:56.000Z" itemprop="datePublished">2019-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/14/usages-of-tail-and-head/">Usages of tail and head</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>The commands <code>tail</code> and <code>head</code>, as their names suggest, respectively print the beginning and ending of files. </p>
<p>You can easily understand the usages of <code>tail</code> with this example: <code>tail -n 50 /var/log/auth.log</code>. This command shows last 50 lines of the <code>auth.log</code> file. And the usages of <code>head</code> are alike. There is only one basic and intuitive option.</p>
<h4 id="Specifying-Unit"><a href="#Specifying-Unit" class="headerlink" title="Specifying Unit"></a>Specifying Unit</h4><p>You wanna lines? Use <code>-n</code>, and there are <code>-c</code> for characters, <code>-b</code> for bytes.</p>
<p>With this knowledge, you can print first 5 characters of a file with command: <code>head -c 5 filename</code>.</p>
<h4 id="Special-Usage-of-tail"><a href="#Special-Usage-of-tail" class="headerlink" title="Special Usage of tail"></a>Special Usage of tail</h4><p>To show a real-time output of a changing file, we can use the <code>-f</code> or <code>--follow</code> options: <code>tail -f /var/log/auth.log</code> prints the end of the file and updates the output when lines are appended to file.</p>
<p>It’s really helpful and handy when you debug your Linux system under some circumstances.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/14/usages-of-tail-and-head/" data-id="cld9kj0by00187swkbasz8iqo" data-title="Usages of tail and head" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-usages-of-cut" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/12/usages-of-cut/" class="article-date">
  <time class="dt-published" datetime="2019-02-12T13:59:56.000Z" itemprop="datePublished">2019-02-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/12/usages-of-cut/">Usages of cut</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>cut</code> command is really useful when it comes to table data handling.</p>
<p>For example, I have a comma-separated values file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- test.txt</span><br><span class="line">John,Smith,34,London</span><br><span class="line">Arthur,Evans,21,Newport</span><br><span class="line">George,Jones,32,Truro</span><br></pre></td></tr></table></figure>

<p>And for generating a special table containing only names and ages, I can execute this: <code>cut -d&#39;,&#39; -f 1,3 &lt; test.txt</code>. Expectedly here comes the result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">John,34</span><br><span class="line">Arthur,21</span><br><span class="line">George,32</span><br></pre></td></tr></table></figure>



<p>In most cases, you need to specify 3 options to properly manipulate the efficient <code>cut</code> command.</p>
<h4 id="Specifying-Delimiter"><a href="#Specifying-Delimiter" class="headerlink" title="Specifying Delimiter"></a>Specifying Delimiter</h4><p>We can use <code>-d</code> option to specify delimiter other than tab the default one. And the delimiter may be specified only when operating on fields(<code>-f</code> option).</p>
<h4 id="Specifying-LIST"><a href="#Specifying-LIST" class="headerlink" title="Specifying LIST"></a>Specifying LIST</h4><p><code>cut</code> can operate on fields, characters or bytes respectively with <code>-f</code>, <code>-c</code> and <code>-b</code> .</p>
<h4 id="Specifying-Range"><a href="#Specifying-Range" class="headerlink" title="Specifying Range"></a>Specifying Range</h4><p>Following the <strong>LIST</strong> option is the range, where you can specify a point (<code>-c 3</code>) or a consecutive range (<code>-c 1-10</code>) and you can combine those together with commas (<code>-c 3,7-9,11</code>).</p>
<blockquote>
<p>Above, <code>-c</code> might be replaced with <code>-f</code> and <code>-b</code> for corresponding purpose.</p>
</blockquote>
<p>By the way, bare it in mind that it is one-based numbering system the <code>cut</code> command is working with other than zero-based one.</p>
<p>There is a option <code>--complement</code>, which indicates complement of currently specified range as range.</p>
<p>For more examples, please refer to web page — <a target="_blank" rel="noopener" href="https://www.computerhope.com/unix/ucut.htm">Reference</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/12/usages-of-cut/" data-id="cld9kj0bt00117swkhdym6jy4" data-title="Usages of cut" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cut/" rel="tag">cut</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-usagesOfAWK" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/11/usagesOfAWK/" class="article-date">
  <time class="dt-published" datetime="2019-02-11T11:55:30.000Z" itemprop="datePublished">2019-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/11/usagesOfAWK/">Usages of awk</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="Basic-Understanding"><a href="#Basic-Understanding" class="headerlink" title="Basic Understanding"></a>Basic Understanding</h4><p>The common template of using <code>awk</code> is like this: <code>awk &#39; &#123; actions &#125; &#39; textFile</code>.</p>
<p>Say I have a text file containing lines:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">------ test.txt</span><br><span class="line">hello world</span><br><span class="line">heLLoWorld ha</span><br><span class="line">London Paris</span><br><span class="line">Changsha Wuhan</span><br><span class="line">Beijing NewYork</span><br><span class="line">Hell Nowhere</span><br></pre></td></tr></table></figure>

<p>This command <code>awk &#39;BEGIN&#123;IGNORECASE=1&#125; /^hel/ &#123; print $2 &#125;&#39; test.txt</code> emits result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">world</span><br><span class="line">ha</span><br><span class="line">Nowhere</span><br></pre></td></tr></table></figure>

<p>So basically, <code>awk</code> just processes every line in the text file respectively and gives out the combined result.</p>
<h4 id="How-to-Do-Regular-Expressions"><a href="#How-to-Do-Regular-Expressions" class="headerlink" title="How to Do Regular Expressions"></a>How to Do Regular Expressions</h4><p>According to the example above as well as the following one, you can easily get the point of doing regex with <code>awk</code>.</p>
<p>Let’s say we have a text file called <code>test.txt</code> whose content is as follows:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test 123</span><br><span class="line">TEd show</span><br><span class="line">Howday Tom</span><br><span class="line">Hahahha</span><br><span class="line">testing, take it easy</span><br></pre></td></tr></table></figure>

<p>To grab every line where there is word “test”, try this: <code>awk &quot; /test/ &#123; print &#125; &quot; test.txt</code>. The part specifying the regular expression is <code>/test/</code></p>
<h4 id="How-to-do-Conditionals"><a href="#How-to-do-Conditionals" class="headerlink" title="How to do Conditionals"></a>How to do Conditionals</h4><p>For example, <code>awk &#39; &#123; if ( $1 ~ /test/ ) print &#125; &#39; test.txt</code> will find out every line whose first column is word “test” (case-sensitive).</p>
<h4 id="How-to-Specify-Column-Seperator"><a href="#How-to-Specify-Column-Seperator" class="headerlink" title="How to Specify Column Seperator"></a>How to Specify Column Seperator</h4><p>with <code>-F</code> option, you can denote the separator in place of white space, which is the default. Look at the example : <code>awk -F, &#39; &#123; print $1 &#125; &#39; test.txt</code> will print out the first column of each line separated by commas.</p>
<p>Please refer to GOOGLE SEARCH for more in-depth insights.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/11/usagesOfAWK/" data-id="cld9kj0c7001d7swk4iub5tr0" data-title="Usages of awk" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/awk/" rel="tag">awk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-WaysForFunctiontoReturnValue" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/07/WaysForFunctiontoReturnValue/" class="article-date">
  <time class="dt-published" datetime="2019-02-07T08:33:05.000Z" itemprop="datePublished">2019-02-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/07/WaysForFunctiontoReturnValue/">Ways For Function to Return Value</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Modularization design of code has many advantages. As an essential role regarding to code modularization, exploitation of functions ought to be gotten the hang of.</p>
<p>The basic function declaration syntax is like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">funcIdentifier</span></span>() &#123;</span><br><span class="line">    <span class="comment"># commands</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>or this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">funcIdentifier</span></span> () &#123;</span><br><span class="line">    <span class="comment"># commands</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After the declaration, you can invoke the function like this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">funcIdentifier param1 param2</span><br></pre></td></tr></table></figure>

<p>And inside of the function, you can easily get the parameters using <code>$1</code>, <code>$2</code>, <code>$3</code> ,etc. </p>
<p>But how to get the result value ? There are a few ways to do the trick.</p>
<ul>
<li>Using <code>echo</code> inside of function and with the help of command substitution you get the result</li>
</ul>
<ul>
<li><code>eval</code> command’ll be evaluated twice. First is of the contents at both side of equal sign, the second one is the actual value assignment</li>
<li>Global variables</li>
</ul>
<p>In order to get stuffs across intuitively, I provide examples for first two approaches :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">sum</span></span> () &#123;</span><br><span class="line">    <span class="built_in">echo</span> `<span class="built_in">expr</span> <span class="variable">$1</span> + <span class="variable">$2</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=$(<span class="built_in">sum</span> 12 13)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">sum</span></span> () &#123;</span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$1</span>=<span class="string">&#x27;`&#x27;</span> <span class="string">&quot;expr <span class="variable">$2</span> + <span class="variable">$3</span>&quot;</span> <span class="string">&#x27;`&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">result=0</span><br><span class="line"><span class="built_in">sum</span> result 12 13</span><br></pre></td></tr></table></figure>



<p>Understanding these two techniques of returning values from functions will help you understand more about the shell interpreter.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/07/WaysForFunctiontoReturnValue/" data-id="cld9kj0b6000o7swkhd6t9k2o" data-title="Ways For Function to Return Value" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-arithmetic-operation-in-bash" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/07/arithmetic-operation-in-bash/" class="article-date">
  <time class="dt-published" datetime="2019-02-07T08:33:05.000Z" itemprop="datePublished">2019-02-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/07/arithmetic-operation-in-bash/">Arithmetic Operation In Bash</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>To learn about this topic, let’s start with a problem.</p>
<p>Snippet of code below is to be implemented:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=13</span><br><span class="line">b=12</span><br><span class="line"></span><br><span class="line"><span class="comment"># Please calculate their quotinent (a / b) </span></span><br></pre></td></tr></table></figure>

<p>As much as I have learnt about arithmetic operations, there are 4 kinds of feasible solutions for BASH.</p>
<ul>
<li><code>$(( expression ))</code> gives the result of the calculation</li>
<li>Also you can do calculation using <code>`expr expression`</code></li>
<li>To do calculation and assign the result directly, you can try this: <code>((result = $a + $b))</code> as well as <code>((result = a + b))</code>, where result, <code>a</code> and <code>b</code> are all shell variables.</li>
<li>Using bc calculator with pipe.</li>
</ul>
<p>For that problem, and with the help of the hints, we can provide 4 structurally different solutions respectively.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sol.1 </span></span><br><span class="line">result=$((a / b))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sol.2</span></span><br><span class="line">result=`<span class="built_in">expr</span> a / b`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sol.3</span></span><br><span class="line">((result = a / b))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sol.4  </span></span><br><span class="line">result=`<span class="built_in">echo</span> <span class="string">&quot;scale=16; <span class="variable">$a</span>/<span class="variable">$b</span>&quot;</span> | bc<span class="string">&quot;`</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>If you try them all out, you will find that only the last solution gives float number as result. So one thing you should bear in mind is that built-in calculation of bash only does integers. To do float points, you must get the assistanse of external tools, in which <code>bc</code> is the one mostly referred to.</p>
<blockquote>
<p>Built-in arithmetic operation in bash only does integers.</p>
</blockquote>
<p>With this basic experience with arthmetic operation of bash and help of GOOGLE SEARCH, you can now solve more problems.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://leegenux.xyz/2019/02/07/arithmetic-operation-in-bash/" data-id="cld9kj0b7000q7swkct2te2bk" data-title="Arithmetic Operation In Bash" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PIC32/" rel="tag">PIC32</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PIC32MX/" rel="tag">PIC32MX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/" rel="tag">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crack/" rel="tag">crack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cracking/" rel="tag">cracking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cut/" rel="tag">cut</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dll/" rel="tag">dll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/embeded/" rel="tag">embeded</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo-blog-framework/" rel="tag">hexo, blog framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextcloud/" rel="tag">nextcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paste/" rel="tag">paste</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pe/" rel="tag">pe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/" rel="tag">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tr/" rel="tag">tr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uniq/" rel="tag">uniq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win32/" rel="tag">win32</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/PIC32/" style="font-size: 10px;">PIC32</a> <a href="/tags/PIC32MX/" style="font-size: 10px;">PIC32MX</a> <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/crack/" style="font-size: 10px;">crack</a> <a href="/tags/cracking/" style="font-size: 10px;">cracking</a> <a href="/tags/cut/" style="font-size: 10px;">cut</a> <a href="/tags/dll/" style="font-size: 10px;">dll</a> <a href="/tags/embeded/" style="font-size: 10px;">embeded</a> <a href="/tags/hexo-blog-framework/" style="font-size: 10px;">hexo, blog framework</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/nextcloud/" style="font-size: 10px;">nextcloud</a> <a href="/tags/paste/" style="font-size: 10px;">paste</a> <a href="/tags/pe/" style="font-size: 12.5px;">pe</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/shell/" style="font-size: 17.5px;">shell</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/sort/" style="font-size: 10px;">sort</a> <a href="/tags/tr/" style="font-size: 10px;">tr</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/uniq/" style="font-size: 10px;">uniq</a> <a href="/tags/win32/" style="font-size: 12.5px;">win32</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/24/Introduction-to-Hexo-Blog-Framework/">Introduction to Hexo Blog Framework</a>
          </li>
        
          <li>
            <a href="/2023/01/24/understanding-pe-format/">Basics of PE Format(1)</a>
          </li>
        
          <li>
            <a href="/2023/01/24/usage%20of%20derper%20and%20certbot/">Configuration of Tailscale Derper and Certbot</a>
          </li>
        
          <li>
            <a href="/2019/07/06/PIC32-configuration/">PIC32MX Basics --- Basic Configuration</a>
          </li>
        
          <li>
            <a href="/2019/04/07/lengthOfLongestSubstring/">Algorithm Practice --- Length Of Longest Substring Containing No Repetitive Characters.</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Evan Lee<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>